applications:
  lb:
    source:
      github:
        project: "seanenck/lockbox"
        release:
          asset: "tarball"
    commands:
      environment:
        variables:
          values:
            "BUILDPATH": "target"
      steps:
        - command: ["just", "version={{ $.Vars.Tag }}"]
        - command: ["/bin/sh", "-c", "$BUILDPATH/{{ $.Name }} completions > $COMPLETIONS/{{ $.Name }}.bash"]
        - command: ["ln", "-sf", "{{ $.Vars.Directory}}/$BUILDPATH/{{ $.Name }}", "$DESTDIR/{{ $.Name }}"]
  age:
    source:
      github:
        project: "FiloSottile/age"
        release:
          asset: "tarball"
    commands:
      steps:
        - command: ["go", "build", "-trimpath", "-buildmode=pie", "-mod=readonly", "-modcacherw", "-ldflags", "-X main.Version={{ $.Vars.Tag }}", "-o", ".", "./..."]
        - command: ["ln", "-sf", "{{ $.Vars.Directory}}/{{ $.Name }}", "$DESTDIR/{{ $.Name }}"]
        - command: ["ln", "-sf", "{{ $.Vars.Directory}}/{{ $.Name }}-keygen", "$DESTDIR/{{ $.Name }}-keygen"]
