applications:
  rclone:
    source:
      github:
        project: "rclone/rclone"
        release:
          asset: "rclone-(.+?)-osx-arm64.zip"
  blap:
    source:
      github:
        project: "seanenck/blap"
        release:
          asset: "tarball"
    commands:
      environment:
        variables:
          values:
            "BUILDPATH": "target"
      steps:
        - command: ["just", "version={{ $.Vars.Tag }}"]
        - command: ["/bin/sh", "-c", "$BUILDPATH/{{ $.Name }} completions > $COMPLETIONS/{{ $.Name }}.bash"]
        - command: ["ln", "-sf", "{{ $.Vars.Directory}}/$BUILDPATH/{{ $.Name }}", "$DESTDIR/{{ $.Name }}"]
  shellcheck:
    source:
      github:
        project: "koalaman/shellcheck"
        release:
          asset: '{{ $.OS }}.{{ if eq $.Arch "amd64" }}x86_64{{ end }}.tar.xz$'
    commands:
      steps:
        - command: ["ln", "-sf", "{{ $.Vars.Directory}}/{{ $.Name }}", "$DESTDIR/{{ $.Name }}"]
  efm:
    source:
      github:
        project: "mattn/efm-langserver"
        release:
          asset: "tarball"
    commands:
      environment:
        variables:
          values:
            "NAME": "efm-langserver"
      steps:
        - command: ["go", "build", "-ldflags", "-X main.revision={{ $.Vars.Tag }}", "-o", "$NAME", "."]
        - command: ["ln", "-sf", "{{ $.Vars.Directory}}/$NAME", "$DESTDIR/$NAME"]
  gittools:
    source:
      github:
        project: "seanenck/git-tools"
        branch:
          name: "master"
    commands:
      environment:
        variables:
          values:
            "UNCOMMIT": "git-uncommitted"
            "CURSTATE": "git-current-state"
      steps:
        - command: ["just"]
        - command: ["ln", "-sf", "{{ $.Vars.Directory}}/$UNCOMMIT", "$DESTDIR/$UNCOMMIT"]
        - command: ["ln", "-sf", "{{ $.Vars.Directory}}/$CURSTATE", "$DESTDIR/$CURSTATE"]
