#!/usr/bin/env bash
CACHE=$HOME/.cache/gitcc
OVERRIDE=$LOCAL_ENV/lib/git/
mkdir -p $CACHE
if [ -z "$1" ]; then
    echo "remote required"
    exit 1
fi
if [[ "$1" == "--list" ]]; then
    if [ -d "$OVERRIDE" ]; then
        ls $OVERRIDE
    fi
    exit 0
fi
if [ -z "$LOCAL_ENV" ] || [ ! -d "$LOCAL_ENV" ]; then
    echo "LOCAL_ENV not set"
    exit 1
fi
OVERRIDE=$OVERRIDE$(echo $1 | cut -d ":" -f 1)
CLONE=$1
CONFIG=""
if [ -d $OVERRIDE ]; then
    CLONE=$(cat $OVERRIDE/url)$(echo "$1" | cut -d ":" -f 2-)
    CONFIG=$OVERRIDE/config
    if [ ! -e $CONFIG ]; then
        CONFIG=""
    fi
fi
NAME=$(basename $1 | rev | cut -d ":" -f 1 | rev)
if git clone "$CLONE" $NAME; then
    if [ -n "$CONFIG" ]; then
        cat $CONFIG >> $NAME/.git/config
    fi
fi
