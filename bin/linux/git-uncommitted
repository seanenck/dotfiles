#!/usr/bin/env bash
PATHS=""
for option in ".env" "workspace"; do
    if [ -d "$HOME/$option" ]; then
        PATHS="$PATHS "$(find "$HOME/$option" -mindepth 1 -maxdepth 1 -type d)
    fi
done

_uncommitted() {
    local origin
    if [ ! -d "$1/.git" ]; then
        return
    fi
    origin=$(git -C "$1" remote show)
    if [ -z "$origin" ]; then
        return
    fi
    git -C "$1" update-index -q --refresh
    git -C "$1" diff-index --name-only HEAD --
    git -C "$1" status -sb | grep ahead
    git -C "$1" ls-files --other --exclude-standard
    git -C "$1" branch --show-current | grep -v "master"
}

first=1
for p in $(echo "$PATHS" | tr ' ' '\n' | sort); do
    uncommit=$(_uncommitted "$p")
    if [ -n "$uncommit" ]; then
        if [ $first -eq 1 ]; then
            echo
            echo "uncommitted:"
        fi
        echo "  -> $p"
        first=0
    fi
done
if [ $first -ne 1 ]; then
    echo
fi
