#!/usr/bin/python3
"""Menu helper."""
import csv
import os
import urllib.parse
import shlex
import subprocess

_APPS = {"firefox": ["firefox"],
         "kitty": ["kitty"],
         "volume": ["pavucontrol"],
         "mumble": ["mumble"]}


def main():
    """Program entry."""
    home = os.environ["HOME"]

    with open(os.path.join(home, ".env", "workstations", "commands.csv")) as f:
        c = csv.DictReader(f)
        for o in c:
            _APPS[o["name"]] = shlex.split(o["command"])
    keys = sorted(_APPS.keys())
    count = str(len(keys))
    p = subprocess.Popen(["wofi",
                          "--show",
                          "dmenu",
                          "-W",
                          "20%",
                          "-L",
                          count,
                          "--style",
                          os.path.join(home, ".config/wofi/style.css")],
                         stdin=subprocess.PIPE,
                         stdout=subprocess.PIPE,
                         stderr=subprocess.DEVNULL)
    for k in keys:
        p.stdin.write((k + "\n").encode())
    o, _ = p.communicate()
    chosen = o.decode().strip()
    if not chosen:
        return
    if chosen in keys:
        subprocess.run(_APPS[chosen])
        return
    parsed = urllib.parse.quote(chosen)
    subprocess.run(["firefox", "https://duckduckgo.com?q={}".format(parsed)])


if __name__ == "__main__":
    main()
