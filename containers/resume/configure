#!/usr/bin/env bash
BIN=$PWD/bin
LOCAL=$LOCAL_ENV/lib/resume/
if [ ! -d "$LOCAL" ]; then
    echo "missing local definitions"
    exit 1
fi
_clean() {
    rm -f $BIN/*.patch $BIN/resume.*
}

mkdir -p $BIN
_clean
cp $LOCAL/* $BIN/
cp build.sh $BIN/

COMMIT=$(git ls-remote https://github.com/enckse/resume | grep HEAD | awk '{print $1}')
echo "Using commit: $COMMIT"

podman build --volume $BIN:/opt --build-arg=COMMIT="$COMMIT" -f Containerfile -t resume
_clean
