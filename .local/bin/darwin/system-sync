#!/bin/sh
ACTIVE="$HOME/Active"
DIR="$ACTIVE/air"

rm -f "$DIR/Brewfile"
if ! (cd "$DIR" && brew bundle dump); then
  echo "failed to brew dump"
  exit 1
fi

if ! cp "$HOME/.config/vm/alpine.json" "$DIR/vm.json"; then
  echo "failed to copy vm config"
  exit 1
fi

for SUB in $(ls "$ACTIVE"); do
  if ! rsync -avc --delete-after "$ACTIVE/$SUB/" "mini.voidedtech.com:~/Active/synced/$SUB/"; then
    echo "failed to rsync state"
    exit 1
  fi
done
