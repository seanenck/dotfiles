#!/bin/sh
SCREEN_NAME="vfu-vm"
CONFIG="$HOME/.config/vm/alpine.json"
if [ -z "$1" ]; then
  echo "command required"
  exit 1
fi

case "$1" in
  "status")
    if screen -list 2>/dev/null | grep -q "$SCREEN_NAME"; then
      echo "running"
      exit 0
    fi
    echo "stopped"
    ;;
  "start")
    if ! rsync -c "$CONFIG" "$HOME/.local/voidedtech/tmp/vm/alpine.json"; then
      echo "failed to backup config"
      exit 1
    fi
    screen -d -m -S "$SCREEN_NAME" vfu --config "$CONFIG"
    ;;
  *)
    echo "unknown command"
    exit 1
esac
