#!/bin/sh
LOGS="/Users/enck/Library/vfu"
mkdir -p "$LOGS"
SCREEN="vfu-vm"
STOPPED="stopped"
IS_BOOTSTRAP="bootstrap"
if [ -z "$1" ]; then
    if screen -list | grep -q "$SCREEN"; then
      echo "running"
    else
      echo "$STOPPED"
    fi
    exit 0
fi
if [ "$1" != "start" ]; then
  if [ "$1" = "$IS_BOOTSTRAP" ]; then
    /Applications/vfu.app/Contents/MacOS/vfu-cli --config "$HOME/.config/vm/alpine.json" >> "$LOGS/$(date +%Y-%m-%d)" 2>&1
    exit 0
  fi
  echo "unknown command"
  exit 1
fi
STATUS=$("$0")
if [ "$STATUS" = "$STOPPED" ]; then
  echo "starting..."
  exec screen -d -m -S "$SCREEN" $0 "$IS_BOOTSTRAP"
fi
