#!/bin/sh
for f in $(ls); do
  if [ -d "$f" ]; then
    continue
  fi
  ext=$(echo "$f" | rev | cut -d "." -f 1 | tr '[:upper:]' '[:lower:]' | rev)
  target="$(date +%d).$(date +%H%M%S).$(shasum -a 256 "$f" | cut -c 1-7)."
  case "$ext" in
    "jpg" | "mov" | "jpeg")
      target="$target$ext"
      echo "renaming: $f -> $target"
      if ! mv "$f" "$target"; then
        echo "  -> failed"
        exit 1
      fi
    ;;
    "heic")
      target="${target}jpeg"
      echo "converting: $f -> target"
      if ! sips --setProperty format jpeg --out "$target" "$f"; then
        echo "  -> unable to convert"
        exit 1
      fi
      rm -f "$f"
    ;;
  esac
done
