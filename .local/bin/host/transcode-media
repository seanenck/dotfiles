#!/bin/sh
for f in $(ls | grep -v " "); do
    EXT=$(echo "$f" | rev | cut -d "." -f 1 | rev | tr '[:upper:]' '[:lower:]')
    TARGET="$(date +%d.T_%H%M%S).$(shasum -a 256 "$f" | cut -c 1-7)"
    case "$EXT" in
      "jpeg" | "jpg" | "mov")
        TARGET="$TARGET.$EXT"
        echo "renaming: $f -> $TARGET"
        if ! mv "$f" "$TARGET"; then
          echo "failed to rename"
          exit 1
        fi
        ;;
      "heic")
        TARGET="$TARGET.jpeg"
        echo "transcoding: $f"
        if ! sips --setProperty format jpeg --out "$TARGET" "$f"; then
          echo "failed to transcode heic"
          exit 1
        fi
        rm -f "$1"
        ;;
    esac
done
