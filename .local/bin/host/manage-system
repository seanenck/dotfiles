#!/bin/sh
UPDATE="update-toolbox"
BUILD="build-toolbox"
ALL="update-all"
CMDS="$UPDATE $BUILD"
if [ -z "$1" ]; then
  echo "command required"
  exit 1
fi
case "$1" in
  "$BUILD")
    exec podman build -f "$HOME/.config/voidedtech/toolbox.Containerfile" -t voidedtech-toolbox-39
    ;;
  "$UPDATE" | "$ALL")
    if ! neovim-plugins; then
      echo "failed to update neovim plugins"
      exit 1
    fi
    #toolbox run -c "go" fish -c "$HOME/.local/bin/go/gotooling"
    for TB in $(toolbox list -c | tail -n +2 | awk '{print $2}'); do
      echo "updating: $TB"
      if ! toolbox run -c "$TB" sudo dnf update -y; then
        echo "update failed"
        exit 1
      fi
    done 
    ;;
  "fish")
    cat << EOF
complete -c manage-system -f
complete -c manage-system -n "not __fish_seen_subcommand_from $CMDS" -a "$CMDS"
EOF
    ;;
  *)
    echo "unknown command: $1"
    exit 1
    ;;
esac
