#!/usr/bin/env bash
BIN=$PWD/bin/
CACHE=$HOME/.cache/adv360
mkdir -p $BIN
if [ ! -d $CACHE ]; then
    git clone https://github.com/KinesisCorporation/Adv360-Pro-ZMK $CACHE
    git -C $CACHE checkout V1.0
fi
rsync -avc --delete-after $CACHE $BIN
PATCH=$PWD/keys.patch
(cd $BIN/adv360 && patch -p1 < $PATCH)
podman build --volume $BIN:/opt/ -f Containerfile -t kinesis
