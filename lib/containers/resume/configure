#!/usr/bin/env bash
if [ -z "$HOME_ADDRESS" ]; then
    echo "please set address"
    exit 1
fi
if [ -z "$HOME_PHONE" ]; then
    echo "please set phone"
    exit 1
fi
if [ -z "$HOME_EMAIL" ]; then
    echo "please set email"
    exit 1
fi

BIN=$PWD/bin
_clean() {
    rm -f $BIN/*.patch $BIN/resume.*
}

mkdir -p $BIN
_clean
cp $HOME/.env/local/lib/work/resume.patch $BIN/work.patch
cp resume.sh $BIN/resume.sh
{
    echo "export ADDRESS=\"$HOME_ADDRESS\""
    echo "export PHONE=\"$HOME_PHONE\""
    echo "export EMAIL=\"$HOME_EMAIL\""
} > $BIN/resume.env

COMMIT=$(git ls-remote https://github.com/enckse/resume | grep HEAD | awk '{print $1}')
echo "Using commit: $COMMIT"

podman build --volume $BIN:/opt --build-arg=COMMIT="$COMMIT" -f Containerfile -t resume
_clean
