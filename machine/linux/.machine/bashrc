export GOPATH="$HOME/.cache/go"
#!/bin/bash

sys-upgrade() {
    local lxc lxcpath lxcwork file lxcuser
    for lxc in $(sudo lxc-ls); do
        lxcpath="/var/lib/lxc/$lxc/rootfs/"
        for lxcuser in "root" "home/enck"; do
            lxcwork="${lxcpath}$lxcuser/"
            for file in .bashrc .vimrc .profile .bash_aliases .tmux.conf; do
                sudo cp $HOME/$file ${lxcwork}$file
            done
            lxcwork="${lxcwork}.vim/pack"
            sudo mkdir -p $lxcwork
            sudo rsync -avc --delete-after $HOME/.vim/pack/ "$lxcwork"
        done
    done
}

_lxc-dev() {
    sudo lxc-ls --running | grep -q "$1"
    if [ $? -ne 0 ]; then
        sudo lxc-start -n $1
    fi
    sudo lxc-attach -n $1 -- su - enck
}

machine() {
    _lxc-dev $@
}

export GPG=TTY=$(tty)
gpg-connect-agent updatestartuptty /bye > /dev/null

if [[ -z $TMUX ]]; then
    tmux_session="sshsession"
    if [ -z "$SSH_CONNECTION" ]; then
        tmux_session="localsession"
    fi
    exec tmux new-session -A -s $tmux_session
fi
