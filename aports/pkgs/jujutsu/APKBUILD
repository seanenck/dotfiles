pkgname=jujutsu
pkgver=0.8.0
pkgrel=2
pkgdesc='A git-compatible DVCS'
arch="all"
url='https://github.com/martinvonz/jj'
license="Apache-2.0"
depends="zlib openssl"
makedepends="cargo openssl-dev"
options="!check chmod-clean net"
source="$pkgname-$pkgver.tar.gz::https://github.com/martinvonz/jj/archive/refs/tags/v$pkgver.tar.gz"
subpackages="$pkgname-bash-completion"
builddir="$srcdir/jj-$pkgver"

prepare() {
  default_prepare
  cargo fetch --target="$CTARGET" --locked
}

build() {
  cargo build --frozen --release
  ./target/release/jj util completion --bash > jj.bash
}

package() {
  install -vDm755 -t "$pkgdir/usr/bin" target/release/jj
  install -Dm644 jj.bash "$pkgdir/usr/share/bash-completion/completions/jj"
}

sha512sums="
773ac1a7e435efad338055197531a7da0ad5be73bb44b223978a59e5ede100bfb65165eae85dee7beb04dda0572ce78a9ad99bac2fd6e426a19102f159df8190  jujutsu-0.8.0.tar.gz
"
